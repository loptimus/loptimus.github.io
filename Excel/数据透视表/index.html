<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0"><link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.1.0",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!1,fastclick:!1,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="数据透视表 这里将通过OLEDB接口使用SQL语句合并多文件的数据源，然后使用合并后的数据创建多个数据透视表，并在某些透视表中增加计算项和条件格式处理，最后添加切片器控制多个透视表的图表。"><meta property="og:type" content="article"><meta property="og:title" content="数据透视表"><meta property="og:url" content="http://yoursite.com/Excel/数据透视表/index.html"><meta property="og:site_name" content="QuickNotes"><meta property="og:description" content="数据透视表 这里将通过OLEDB接口使用SQL语句合并多文件的数据源，然后使用合并后的数据创建多个数据透视表，并在某些透视表中增加计算项和条件格式处理，最后添加切片器控制多个透视表的图表。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/poly.gif"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/povit.gif"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/sales.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/plan.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_1.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_2.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_3.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_4.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_5.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_6.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_7.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_8.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_9.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_10.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_11.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_12.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case1_final.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_1.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_2.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_3.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_4.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_5.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_6.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_7.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_8.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_9.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_10.jpg"><meta property="og:image" content="http://yoursite.com/Excel/数据透视表/case2_final.jpg"><meta property="og:updated_time" content="2019-07-01T10:34:47.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="数据透视表"><meta name="twitter:description" content="数据透视表 这里将通过OLEDB接口使用SQL语句合并多文件的数据源，然后使用合并后的数据创建多个数据透视表，并在某些透视表中增加计算项和条件格式处理，最后添加切片器控制多个透视表的图表。"><meta name="twitter:image" content="http://yoursite.com/Excel/数据透视表/poly.gif"><link rel="canonical" href="http://yoursite.com/Excel/数据透视表/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>数据透视表 | QuickNotes</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">QuickNotes</span><span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益 404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header> <a href="https://github.com/loptimus" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/Excel/数据透视表/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="lwl"><meta itemprop="description" content><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="QuickNotes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">数据透视表</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-02-26 18:34:47" itemprop="dateCreated datePublished" datetime="2019-02-26T18:34:47+08:00">2019-02-26</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-07-01 18:34:47" itemprop="dateModified" datetime="2019-07-01T18:34:47+08:00">2019-07-01</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Excel/" itemprop="url" rel="index"><span itemprop="name">Excel</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数：<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">3.3k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">3 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="数据透视表">数据透视表</h1><p>这里将通过OLEDB接口使用SQL语句合并多文件的数据源，然后使用合并后的数据创建多个数据透视表，并在某些透视表中增加计算项和条件格式处理，最后添加切片器控制多个透视表的图表。</p><a id="more"></a><p>最终效果如下：</p> <img src="/Excel/数据透视表/poly.gif" title="动态图"> <img src="/Excel/数据透视表/povit.gif" title="数据透视图"><h2 id="数据文件">数据文件</h2><p>这里使用的数据是虚构的某家公司的销售数据，一共有6个数据文件，分别是："常熟.xlsx"、"昆山.xlsx"、"南京.xlsx"、"苏州.xlsx"、"无锡.xlsx"、"销售计划.xlsx"。其中，前5个数据文件保存的是每个城市的实际销售数据，其数据结构为：</p> <img src="/Excel/数据透视表/sales.jpg" title="销售数据"><p>"销售计划.xlsx"保存的是各个城市的计划销售金额，其数据结构为：</p> <img src="/Excel/数据透视表/plan.jpg" title="销售计划"><p>现假设将它们放在电脑D盘的"D:_table"目录下，并在"D:_table"目录下创建文件"数据透视表.xlsx"，用于合并数据源及处理本文的所有数据透视表内容。</p><h2 id="切片器控制多个图表">切片器控制多个图表</h2><p>这里将通过OLEDB接口使用SQL语句将多个数据文件的数据合并到文件"数据透视表.xlsx"的工作表中，然后再使用合并的数据创建数据透视图及透视图相应的图表，最后再添加切片器控制多图表联动。当数据源的文件内容有更新时，可以在"数据透视表.xlsx"文件中进行“<strong>刷新</strong>”，使得相应的数据透视图数据和图表数据也进行更新。</p><h3 id="合并数据源">合并数据源</h3><p>打开文件"数据透视表.xlsx"，选择菜单栏中的“数据”菜单项，点击该菜单项中的“现有连接”按钮，弹出“现有连接”对话框，再点击“浏览更多”按钮，弹出选择文件对话框，然后找到"数据透视表.xlsx"文件所在位置，即"D:_table"。</p> <img src="/Excel/数据透视表/case1_1.jpg" title="合并数据源"><p>选择"数据透视表.xlsx"文件并打开，弹出“选择表格”对话框，勾选“数据首行包含列标签”，然后点击确定。</p> <img src="/Excel/数据透视表/case1_2.jpg" title="合并数据源"><p>点击确定后弹出“导入数据”对话框，在该对话框中，将数据在工作簿的显示方式设置为“表”，数据的放置位置设置为“新工作表”，然后点击属性按钮。</p> <img src="/Excel/数据透视表/case1_3.jpg" title="合并数据源"><p>在弹出的连接属性对话框中，点击“定义”选项卡，在该选项卡中的“命令文本”框中输入以下SQL语句：</p> <img src="/Excel/数据透视表/case1_4.jpg" title="合并数据源"><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">"苏州"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\苏州.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"南京"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\南京.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"无锡"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\无锡.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"常熟"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\常熟.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"昆山"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\昆山.xlsx].[销售数据$]</span><br></pre></td></tr></table></figure><p>该SQL语句的作用是将不同数据源文件的销售数据合并到同一张表中，并添加“所属区域”字段用于区分数据来源。输入完SQL语句后，点击确定，回到“导入数据”对话框中，再次点击确定，即可将数据导入到"数据透视表.xlsx"文件中。</p> <img src="/Excel/数据透视表/case1_5.jpg" title="合并数据源"><p>将导入在"数据透视表.xlsx"文件中数据所在的工作区命名为“销售数据源”，接下来将使用该数据表进行数据透视表的创建。</p><h3 id="创建数据透视表">创建数据透视表</h3><p>这里将使用“销售数据源”工作区中数据创建4张数据透视表，每张数据透视表使用一个新的工作区，并为每张透视表数据创建图形。</p><ul><li>按年、季度查看各个销售部门的销售金额</li></ul><p>将订购日期按年、季度进行组合，并创建各个销售部门的销售金额随时间变化的趋势图。</p> <img src="/Excel/数据透视表/case1_6.jpg" title="数据透视表"><ul><li>查看各所属区域的销售金额和成本的对比</li></ul> <img src="/Excel/数据透视表/case1_7.jpg" title="数据透视表"><ul><li>查看各产品类别的销售金额</li></ul> <img src="/Excel/数据透视表/case1_8.jpg" title="数据透视表"><ul><li>查看各销售部门的销售金额</li></ul> <img src="/Excel/数据透视表/case1_9.jpg" title="数据透视表"><h3 id="创建切片器">创建切片器</h3><p>新建一个名为“切片器演示”的工作区，将上面所有数据透视表的图形都拷贝到该工作区，然后再任意一个数据透视表中插入三个切片器：年份、销售人员、产品类别。</p> <img src="/Excel/数据透视表/case1_10.jpg" title="切片器"><p>将这三个切片器剪切到“切片器演示”工作区中后，分别选中每个切片器，单击右键，选择“报表连接”选项，然后勾选中上面4个透视表进行连接，最后点击确定即可将切片器与多个数据透视表和透视表图形联动起来。</p> <img src="/Excel/数据透视表/case1_11.jpg" title="切片器"> <img src="/Excel/数据透视表/case1_12.jpg" title="切片器"><p>最后效果如下：</p> <img src="/Excel/数据透视表/case1_final.jpg" title="切片器效果"><h2 id="条件格式">条件格式</h2><h3 id="合并数据源-1">合并数据源</h3><p>这里合并数据源的操作与切片器控制多个图表部分合并数据源的操作几乎是一样的操作，唯一的区别在于所获取数据的SQL语句不同。这里所使用的SQL语句如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">"实际"</span> <span class="keyword">AS</span> 类型, <span class="string">"苏州"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\苏州.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"实际"</span> <span class="keyword">AS</span> 类型, <span class="string">"南京"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\南京.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"实际"</span> <span class="keyword">AS</span> 类型, <span class="string">"无锡"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\无锡.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"实际"</span> <span class="keyword">AS</span> 类型, <span class="string">"常熟"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\常熟.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"实际"</span> <span class="keyword">AS</span> 类型, <span class="string">"昆山"</span> <span class="keyword">AS</span> 所属区域, * <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\昆山.xlsx].[销售数据$] <span class="keyword">UNION</span> <span class="keyword">ALL</span> <span class="keyword">SELECT</span> <span class="string">"计划"</span> <span class="keyword">AS</span> 类型, 所属区域, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, 销售部门, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, 产品类别, <span class="literal">NULL</span>, 金额, <span class="literal">NULL</span> <span class="keyword">FROM</span> [D:\povit_table\<span class="keyword">data</span>\销售计划.xlsx].[数据$]</span><br></pre></td></tr></table></figure><p>该SQL语句的作用是将不同数据源文件的销售数据及销售计划数据合并到同一张表中，并添“类型”字段区分实际完成和计划完成，添加“所属区域”字段区分数据来源。执行SQL语句得到数据如下：</p> <img src="/Excel/数据透视表/case2_1.jpg" title="合并数据源"><p>将该数据表所在的工作区命名为“业绩数据源”，接下来将使用该数据表进行数据透视表的创建。</p><h3 id="创建数据透视表-1">创建数据透视表</h3><p>这部分要创建一张关于所属区域的各个销售部门的实际完成销售金额和计划完成销售金额的对比。因此该数据透视表需要使用的字段有：所属区域、产品类别、类型，其中类型字段中包含“实际”和“计划”两个项。既然要对比，所以还需在类型字段中增加表示差额的一项。因此，可以让该数据透视表使用类型和产品类别作为行，所属区域作为列。</p> <img src="/Excel/数据透视表/case2_2.jpg" title="数据透视表"><p>可以看到，对该数据透视表进行列总计是没有意义的，所以需要将其去掉。接下来将在要在类型字段中插入计算项。</p><h4 id="计算项">计算项</h4><p>选中类型字段，点击菜单栏中的“数据透视表分析”选项卡，再点击“字段、项目和集”下拉菜单，点击“计算项”，弹出计算项对话框。</p> <img src="/Excel/数据透视表/case2_3.jpg" title="数据透视表"><p>在计算项对话框中，名称文本框中填入“差额”，公式文本框中填入“实际 - 计划”公式，点击“添加”按钮，再点击确定。</p> <img src="/Excel/数据透视表/case2_4.jpg" title="数据透视表"><p>可以看到，类型字段中增加了差额一项。有了差额项之后，可以将计划一项的明细合并起来。为了使数据透视表表现的更有张力，接下来将对实际和差额两项所对应的销售金额进行条件格式处理。</p><ul><li>实际</li></ul><p>因为实际项部分的销售金额体现的是数量的概念，所以使用条件格式中的数据条进行填充显示。</p> <img src="/Excel/数据透视表/case2_5.jpg" title="数据透视表"><ul><li>差额</li></ul><p>因为差额项部分的销售金额体现的是目标是否达成的概念，所以是用条件格式中图表集的三色交通灯表示。</p> <img src="/Excel/数据透视表/case2_6.jpg" title="数据透视表"><p>如果使用三色交通灯的本意是，“绿灯”表示超额完成，“黄灯”表示刚好完成，“红灯”表示未完成。但上图中的有些未完成计划的数据也显示了“绿灯”，所以这时需要修改差额项销售金额的条件格式的管理规则。</p> <img src="/Excel/数据透视表/case2_7.jpg" title="数据透视表"><p>编辑规则，使得规则符合三色交通灯的本意。</p> <img src="/Excel/数据透视表/case2_8.jpg" title="数据透视表"><p>同样，对差额汇总也进行相同的处理。</p> <img src="/Excel/数据透视表/case2_9.jpg" title="数据透视表"><h3 id="创建切片器-1">创建切片器</h3><p>如果需要查看各个销售部门的完成情况，可以在数据透视表中插入“销售部门”切片器。</p> <img src="/Excel/数据透视表/case2_10.jpg" title="数据透视表"><p>最后效果如下：</p> <img src="/Excel/数据透视表/case2_final.jpg" title="数据透视表"></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/概率论与数理统计/常用概率分布/" rel="next" title="常用概率分布"><i class="fa fa-chevron-left"></i> 常用概率分布</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/概率论与数理统计/参数估计/" rel="prev" title="参数估计">参数估计<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">lwl</p><div class="site-description motion-element" itemprop="description"></div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">18</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">23</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#数据透视表"><span class="nav-number">1.</span> <span class="nav-text">数据透视表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据文件"><span class="nav-number">1.1.</span> <span class="nav-text">数据文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#切片器控制多个图表"><span class="nav-number">1.2.</span> <span class="nav-text">切片器控制多个图表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#合并数据源"><span class="nav-number">1.2.1.</span> <span class="nav-text">合并数据源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据透视表"><span class="nav-number">1.2.2.</span> <span class="nav-text">创建数据透视表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建切片器"><span class="nav-number">1.2.3.</span> <span class="nav-text">创建切片器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#条件格式"><span class="nav-number">1.3.</span> <span class="nav-text">条件格式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#合并数据源-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">合并数据源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建数据透视表-1"><span class="nav-number">1.3.2.</span> <span class="nav-text">创建数据透视表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#计算项"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">计算项</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建切片器-1"><span class="nav-number">1.3.3.</span> <span class="nav-text">创建切片器</span></a></li></ol></li></ol></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">lwl</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">164k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">2:29</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv">&nbsp;</span></span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.1.0"></script><script src="/js/motion.js?v=7.1.0"></script><script src="/js/affix.js?v=7.1.0"></script><script src="/js/schemes/pisces.js?v=7.1.0"></script><script src="/js/scrollspy.js?v=7.1.0"></script><script src="/js/post-details.js?v=7.1.0"></script><script src="/js/next-boot.js?v=7.1.0"></script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script><script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script></body></html>