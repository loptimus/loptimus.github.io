<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=7.1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0"><link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.1.0",sidebar:{position:"left",display:"post",offset:12,onmobile:!1,dimmer:!1},back2top:!0,back2top_sidebar:!1,fancybox:!1,fastclick:!1,lazyload:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="假设检验及R实现 主要内容：  已知总体服从正态分布的条件下，单个正态总体和两个正态总体的参数假设检验问题。 比例的检验，大样本检验。 分布拟合检验：Neyman-Pearson卡方检验，Kolmogrov-Smirnov检验（KS检验），Shapiro-Wilk检验（W检验）。"><meta name="keywords" content="R语言,z检验,t检验,F检验,卡方检验,KS检验,W检验"><meta property="og:type" content="article"><meta property="og:title" content="假设检验及R实现"><meta property="og:url" content="http://yoursite.com/R语言/假设检验及r实现/index.html"><meta property="og:site_name" content="QuickNotes"><meta property="og:description" content="假设检验及R实现 主要内容：  已知总体服从正态分布的条件下，单个正态总体和两个正态总体的参数假设检验问题。 比例的检验，大样本检验。 分布拟合检验：Neyman-Pearson卡方检验，Kolmogrov-Smirnov检验（KS检验），Shapiro-Wilk检验（W检验）。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://yoursite.com/R语言/假设检验及r实现/chi_test_norm.png"><meta property="og:updated_time" content="2019-08-02T09:14:43.575Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="假设检验及R实现"><meta name="twitter:description" content="假设检验及R实现 主要内容：  已知总体服从正态分布的条件下，单个正态总体和两个正态总体的参数假设检验问题。 比例的检验，大样本检验。 分布拟合检验：Neyman-Pearson卡方检验，Kolmogrov-Smirnov检验（KS检验），Shapiro-Wilk检验（W检验）。"><meta name="twitter:image" content="http://yoursite.com/R语言/假设检验及r实现/chi_test_norm.png"><link rel="canonical" href="http://yoursite.com/R语言/假设检验及r实现/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>假设检验及R实现 | QuickNotes</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">QuickNotes</span><span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"> <button aria-label="切换导航栏"><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益 404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i></span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"> <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header> <a href="https://github.com/loptimus" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/R语言/假设检验及r实现/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="lwl"><meta itemprop="description" content><meta itemprop="image" content="/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="QuickNotes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">假设检验及R实现</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-02-26 18:34:47" itemprop="dateCreated datePublished" datetime="2019-02-26T18:34:47+08:00">2019-02-26</time> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-08-02 17:14:43" itemprop="dateModified" datetime="2019-08-02T17:14:43+08:00">2019-08-02</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/R语言/" itemprop="url" rel="index"><span itemprop="name">R语言</span></a></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i> 阅读次数：<span class="busuanzi-value" id="busuanzi_value_page_pv"></span></span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">本文字数：</span> <span title="本文字数">19k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">18 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="假设检验及r实现">假设检验及R实现</h1><p><strong>主要内容</strong>：</p><ul><li>已知总体服从正态分布的条件下，单个正态总体和两个正态总体的参数假设检验问题。</li><li>比例的检验，大样本检验。</li><li>分布拟合检验：Neyman-Pearson卡方检验，Kolmogrov-Smirnov检验（KS检验），Shapiro-Wilk检验（W检验）。</li></ul><a id="more"></a><h2 id="正态总体参数假设检验">正态总体参数假设检验</h2><h3 id="单个正态总体的检验">单个正态总体的检验</h3><table><thead><tr class="header"><th>检验对象</th><th>条件</th><th>假设检验方法</th><th>R语言实现</th></tr></thead><tbody><tr class="odd"><td>均值<span class="math inline">\(\mu\)</span></td><td><span class="math inline">\(\sigma^2\)</span>已知</td><td>检验</td><td>z.test（程序包BSDA）</td></tr><tr class="even"><td>均值<span class="math inline">\(\mu\)</span></td><td><span class="math inline">\(\sigma^2\)</span>未知</td><td>检验</td><td>t.test（自带函数）</td></tr><tr class="odd"><td>方差$^2 $</td><td><span class="math inline">\(\mu\)</span>已知</td><td>卡方检验</td><td>自定义函数</td></tr><tr class="even"><td>方差<span class="math inline">\(\sigma^2\)</span></td><td><span class="math inline">\(\mu\)</span>未知</td><td>卡方检验</td><td>自定义函数</td></tr></tbody></table><p><strong>场景数据</strong>：假设2012年各月北京的新建住宅价格指数样本数据如下：</p><table><thead><tr class="header"><th>1月</th><th>2月</th><th>3月</th><th>4月</th><th>5月</th><th>6月</th><th>7月</th><th>8月</th><th>9月</th><th>10月</th><th>11月</th><th>12月</th></tr></thead><tbody><tr class="odd"><td>102.5</td><td>102.4</td><td>102</td><td>101.8</td><td>101.8</td><td>102.1</td><td>102.3</td><td>102.5</td><td>102.6</td><td>102.8</td><td>103.4</td><td>104.2</td></tr></tbody></table><h4 id="均值的检验">均值的检验</h4><h5 id="方差sigma2已知">方差<span class="math inline">\(\sigma^2\)</span>已知</h5><p>若假设上面北京的新建住房价格指数服从正态分布<span class="math inline">\(N(\mu, 0.45)\)</span>，试问在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，猜测价格指数总体均值为102.4，问是否能拒绝这个猜测？</p><p>解：总体服从<span class="math inline">\(N(\mu, 0.45)\)</span>，待检验的原假设为：<span class="math inline">\(\mu = 102.4\)</span>，备择假设为：<span class="math inline">\(\mu \neq 102.4\)</span>。这是一个双侧检验，已知<span class="math inline">\(\sigma^2 = 0.45\)</span>，所以使用<span class="math inline">\(Z\)</span>检验。</p><ul><li>自定义函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">102.5</span>, <span class="number">102.4</span>, <span class="number">102</span>, <span class="number">101.8</span>, <span class="number">101.8</span>, <span class="number">102.1</span>, </span><br><span class="line">       <span class="number">102.3</span>, <span class="number">102.5</span>, <span class="number">102.6</span>, <span class="number">102.8</span>, <span class="number">103.4</span>, <span class="number">104.2</span>)</span><br><span class="line"><span class="comment"># 参数x为样本，mu为原假设范围内的值，sigma为标准差</span></span><br><span class="line"><span class="comment"># alternative："two.sided"双侧检验，"less"左侧检验，"greater"为右侧检验</span></span><br><span class="line">custom.z.test &lt;- <span class="keyword">function</span>(x, mu, sigma, alternative = <span class="string">"two.sided"</span>)&#123;</span><br><span class="line">  n &lt;- length(x) <span class="comment"># 样本容量</span></span><br><span class="line">  mean &lt;- mean(x) <span class="comment"># 样本均值</span></span><br><span class="line">  z &lt;- sqrt(n) * (mean - mu) / sigma <span class="comment"># 统计量</span></span><br><span class="line">  ret &lt;- list()  <span class="comment"># 构造一个空的list，用于存放输出结果</span></span><br><span class="line">  ret$mean &lt;- mean</span><br><span class="line">  ret$z &lt;- z</span><br><span class="line">  <span class="keyword">if</span> (alternative == <span class="string">"two.sided"</span>)</span><br><span class="line">    ret$p &lt;- <span class="number">2</span> * pnorm(abs(z), lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"less"</span>)</span><br><span class="line">    ret$p &lt;- pnorm(z)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"greater"</span>)</span><br><span class="line">    ret$p &lt;- pnorm(z, lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  ret</span><br><span class="line">&#125;</span><br><span class="line">custom.z.test(x, <span class="number">102.4</span>, sqrt(<span class="number">0.45</span>)) <span class="comment"># 调用函数</span></span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$mean</span><br><span class="line">[<span class="number">1</span>] <span class="number">102.5333</span></span><br><span class="line">$z</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.6885304</span></span><br><span class="line">$p</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.4911189</span></span><br></pre></td></tr></table></figure><p>可以看到显著性水平<span class="math inline">\(\alpha = 0.05\)</span>小于检验的<span class="math inline">\(p = 0.4911189\)</span>值，所以在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，不能拒绝原假设。</p><ul><li>BSDA包的z.test函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">"BSDA"</span>) <span class="comment"># 安装BSDA包，若已安装，则删除此行</span></span><br><span class="line"><span class="keyword">library</span>(BSDA)</span><br><span class="line">x &lt;- c(<span class="number">102.5</span>, <span class="number">102.4</span>, <span class="number">102</span>, <span class="number">101.8</span>, <span class="number">101.8</span>, <span class="number">102.1</span>, </span><br><span class="line">       <span class="number">102.3</span>, <span class="number">102.5</span>, <span class="number">102.6</span>, <span class="number">102.8</span>, <span class="number">103.4</span>, <span class="number">104.2</span>)</span><br><span class="line"><span class="comment"># 参数x为样本，mu为原假设范围内的值，sigma为标准差</span></span><br><span class="line"><span class="comment"># alternative："two.sided"双侧检验，"less"左侧检验，"greater"为右侧检验</span></span><br><span class="line">z.test(x = x, mu = <span class="number">102.4</span>, sigma.x = sqrt(<span class="number">0.45</span>), alternative = <span class="string">"two.sided"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">		One-sample z-Test</span><br><span class="line">data:  x</span><br><span class="line">z = <span class="number">0.68853</span>, p-value = <span class="number">0.4911</span></span><br><span class="line">alternative hypothesis: true mean is not equal to <span class="number">102.4</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line"> <span class="number">102.1538</span> <span class="number">102.9129</span></span><br><span class="line">sample estimates:</span><br><span class="line">mean of x </span><br><span class="line"> <span class="number">102.5333</span></span><br></pre></td></tr></table></figure><p>输出结果显示，统计量z = 0.68853，检验的p值p-value = 0.4911，置信水平为0.95时的置信区间[102.1538, 102.9129]。因为显著性水平<span class="math inline">\(\alpha = 0.05\)</span>小于检验的<span class="math inline">\(p=0.4911\)</span>值，所以在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，不能拒绝原假设。</p><h5 id="方差sigma2未知">方差<span class="math inline">\(\sigma^2\)</span>未知</h5><p>若假设上面北京的新建住房价格指数所服从正态分布的总体期望<span class="math inline">\(\mu\)</span>未知，总体方差<span class="math inline">\(\sigma^2\)</span>未知，试问在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，猜测价格指数总体均值为102.4，问是否能拒绝这个猜测？</p><p>解：总体服从<span class="math inline">\(N(\mu, \sigma^2)\)</span>，待检验的原假设为：<span class="math inline">\(\mu = 102.4\)</span>，备择假设为：<span class="math inline">\(\mu \neq 102.4\)</span>。这是一个双侧检验，由于<span class="math inline">\(\sigma^2\)</span>未知，所以使用<span class="math inline">\(t\)</span>检验。</p><ul><li>自定义函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">102.5</span>, <span class="number">102.4</span>, <span class="number">102</span>, <span class="number">101.8</span>, <span class="number">101.8</span>, <span class="number">102.1</span>, </span><br><span class="line">       <span class="number">102.3</span>, <span class="number">102.5</span>, <span class="number">102.6</span>, <span class="number">102.8</span>, <span class="number">103.4</span>, <span class="number">104.2</span>)</span><br><span class="line"><span class="comment"># 参数x为样本，mu为原假设范围内的值，sigma为标准差</span></span><br><span class="line"><span class="comment"># alternative："two.sided"双侧检验，"less"左侧检验，"greater"为右侧检验</span></span><br><span class="line">custom.t.test &lt;- <span class="keyword">function</span>(x, mu, alternative = <span class="string">"two.sided"</span>)&#123;</span><br><span class="line">  n &lt;- length(x) <span class="comment"># 样本容量</span></span><br><span class="line">  df &lt;- n - <span class="number">1</span> <span class="comment"># 自由度</span></span><br><span class="line">  mean &lt;- mean(x) <span class="comment"># 样本均值</span></span><br><span class="line">  <span class="comment"># sigma &lt;- sqrt(sum((x - mean)^2) / df) # 样本标准差</span></span><br><span class="line">  sigma &lt;- sd(x) <span class="comment"># 样本标准差</span></span><br><span class="line">  z &lt;- sqrt(n) * (mean - mu) / sigma <span class="comment"># 统计量</span></span><br><span class="line">  ret &lt;- list()  <span class="comment"># 构造一个空的list，用于存放输出结果</span></span><br><span class="line">  ret$mean &lt;- mean</span><br><span class="line">  ret$z &lt;- z</span><br><span class="line">  ret$df &lt;- df</span><br><span class="line">  <span class="keyword">if</span> (alternative == <span class="string">"two.sided"</span>)</span><br><span class="line">    ret$p &lt;- <span class="number">2</span> * pt(abs(z), df = df, lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"less"</span>)</span><br><span class="line">    ret$p &lt;- pt(z, df = df)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"greater"</span>)</span><br><span class="line">    ret$p &lt;- p(z, df = df, lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  ret</span><br><span class="line">&#125;</span><br><span class="line">custom.t.test(x = x, mu = <span class="number">102.4</span>, alternative = <span class="string">"two.sided"</span>) <span class="comment"># 调用函数</span></span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$mean</span><br><span class="line">[<span class="number">1</span>] <span class="number">102.5333</span></span><br><span class="line">$z</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.6700594</span></span><br><span class="line">$df</span><br><span class="line">[<span class="number">1</span>] <span class="number">11</span></span><br><span class="line">$p</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.5166397</span></span><br></pre></td></tr></table></figure><p>可以看到显著性水平<span class="math inline">\(\alpha = 0.05\)</span>小于检验的<span class="math inline">\(p = 0.5166397\)</span>值，所以在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，不能拒绝原假设。</p><ul><li>t.test函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">102.5</span>, <span class="number">102.4</span>, <span class="number">102</span>, <span class="number">101.8</span>, <span class="number">101.8</span>, <span class="number">102.1</span>, </span><br><span class="line">       <span class="number">102.3</span>, <span class="number">102.5</span>, <span class="number">102.6</span>, <span class="number">102.8</span>, <span class="number">103.4</span>, <span class="number">104.2</span>)</span><br><span class="line"><span class="comment"># 参数x为样本，mu为原假设范围内的值</span></span><br><span class="line"><span class="comment"># alternative："two.sided"双侧检验，"less"左侧检验，"greater"为右侧检验</span></span><br><span class="line">t.test(x = x, mu = <span class="number">102.4</span>, alternative = <span class="string">"two.sided"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	One Sample t-test</span><br><span class="line">data:  x</span><br><span class="line">t = <span class="number">0.67006</span>, df = <span class="number">11</span>, p-value = <span class="number">0.5166</span></span><br><span class="line">alternative hypothesis: true mean is not equal to <span class="number">102.4</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line"> <span class="number">102.0954</span> <span class="number">102.9713</span></span><br><span class="line">sample estimates:</span><br><span class="line">mean of x </span><br><span class="line"> <span class="number">102.5333</span></span><br></pre></td></tr></table></figure><p>输出结果显示，统计量z = 0.67006，检验的p值p-value = 0.5166，置信水平为0.95时的置信区间为[102.0954, 102.9713]，因为显著性水平<span class="math inline">\(\alpha = 0.05\)</span>小于检验的<span class="math inline">\(p=0.5166\)</span>值，所以在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，不能拒绝原假设。</p><h4 id="方差的检验">方差的检验</h4><p>若假设上面北京的新建住房价格指数服从正态分布<span class="math inline">\(N(\mu, \sigma^2)\)</span>，试问在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，猜测价格指数总体方差是否超过0.25，问是否能拒绝这个猜测？</p><p>解：这是一个假设检验的问题，总体<span class="math inline">\(N(\mu, \sigma^2)\)</span>，待检验的原假设为：<span class="math inline">\(\sigma^2 \geq 0.25\)</span>，备择假设为：<span class="math inline">\(\sigma^2 &lt; 0.25\)</span>，这是一个单侧检验。在方差<span class="math inline">\(\sigma^2\)</span>的检验中，无论总体期望<span class="math inline">\(\mu\)</span>是否已知，都可以使用卡方检验。下面是将总体期望<span class="math inline">\(\mu\)</span>已知和未知两种情况下的方差检验写在同一个自定义函数中。</p><ul><li>自定义函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">102.5</span>, <span class="number">102.4</span>, <span class="number">102</span>, <span class="number">101.8</span>, <span class="number">101.8</span>, <span class="number">102.1</span>, </span><br><span class="line">       <span class="number">102.3</span>, <span class="number">102.5</span>, <span class="number">102.6</span>, <span class="number">102.8</span>, <span class="number">103.4</span>, <span class="number">104.2</span>)</span><br><span class="line">chisq.var.test &lt;- <span class="keyword">function</span>(x, var, mu = <span class="literal">Inf</span>, alternative = <span class="string">"two.sided"</span>)&#123;</span><br><span class="line">  n &lt;- length(x) <span class="comment"># 样本容量 </span></span><br><span class="line">  <span class="keyword">if</span>(mu == <span class="literal">Inf</span>) <span class="comment"># 总体均值已知的情况</span></span><br><span class="line">  &#123;</span><br><span class="line">    df &lt;- n - <span class="number">1</span> <span class="comment"># 自由度</span></span><br><span class="line">    v &lt;- var(x) <span class="comment"># 样本方差</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="comment"># 总体均值未知的情况</span></span><br><span class="line">  &#123;</span><br><span class="line">    df &lt;- n <span class="comment"># 自由度</span></span><br><span class="line">    v = sum((x - mu)^<span class="number">2</span>) / n <span class="comment"># 总体方差的极大似然估计MLE</span></span><br><span class="line">  &#125;</span><br><span class="line">  chi &lt;- df * v / var <span class="comment"># 统计量</span></span><br><span class="line">  ret &lt;- list() <span class="comment"># 创建一个空的list，用于存放输出结果</span></span><br><span class="line">  ret$df &lt;- df</span><br><span class="line">  ret$var &lt;- v</span><br><span class="line">  ret$chi &lt;- chi</span><br><span class="line">  <span class="keyword">if</span> (alternative == <span class="string">"two.sided"</span>)</span><br><span class="line">    ret$p &lt;- <span class="number">2</span> * min(pchisq(chi, df), pchisq(chi, df, lower.tail = <span class="literal">FALSE</span>))</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"less"</span>)</span><br><span class="line">    ret$p &lt;- pchisq(chi, df = df)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"greater"</span>)</span><br><span class="line">    ret$p &lt;- pchisq(chi, df = df, lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若总体期望<span class="math inline">\(\mu = 102.4\)</span></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chisq.var.test(x, <span class="number">0.25</span>, mu = <span class="number">102.4</span>, alternative = <span class="string">"less"</span>) <span class="comment"># 总体期望已知</span></span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$df</span><br><span class="line">[<span class="number">1</span>] <span class="number">12</span></span><br><span class="line">$var</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.4533333</span></span><br><span class="line">$chi</span><br><span class="line">[<span class="number">1</span>] <span class="number">21.76</span></span><br><span class="line">$p</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.9597007</span></span><br></pre></td></tr></table></figure><p>若总体期望<span class="math inline">\(\mu\)</span>未知</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chisq.var.test(x, <span class="number">0.25</span>, alternative = <span class="string">"less"</span>) <span class="comment"># 总体期望未知</span></span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$df</span><br><span class="line">[<span class="number">1</span>] <span class="number">11</span></span><br><span class="line">$var</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.4751515</span></span><br><span class="line">$chi</span><br><span class="line">[<span class="number">1</span>] <span class="number">20.90667</span></span><br><span class="line">$p</span><br><span class="line">[<span class="number">1</span>] <span class="number">0.965649</span></span><br></pre></td></tr></table></figure><p>可以看到，无论在总体期望<span class="math inline">\(\mu\)</span>已知或未知的情况下，显著性水平<span class="math inline">\(\alpha = 0.05\)</span>都小于检验的<span class="math inline">\(p\)</span>值，所以在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，不能拒绝原假设。说明新建住宅价格指数的方差大于0.25，变动很大。</p><h3 id="两个正态总体的检验">两个正态总体的检验</h3><table><thead><tr class="header"><th>检验对象</th><th>条件</th><th>假设检验方法</th><th>R语言实现</th></tr></thead><tbody><tr class="odd"><td>比较两总体均值</td><td>方差<span class="math inline">\(\sigma_1^2\)</span>、<span class="math inline">\(\sigma_2^2\)</span>已知</td><td><span class="math inline">\(Z\)</span>检验</td><td>z.test（程序包BSDA）</td></tr><tr class="even"><td>比较两总体均值</td><td>方差<span class="math inline">\(\sigma_1^2\)</span>、<span class="math inline">\(\sigma_2^2\)</span>未知但相等</td><td><span class="math inline">\(t\)</span>检验</td><td>t.test（自带函数）</td></tr><tr class="odd"><td>比较两总体均值</td><td>方差<span class="math inline">\(\sigma_1^2\)</span>、<span class="math inline">\(\sigma_2^2\)</span>未知且不等</td><td>近似<span class="math inline">\(t\)</span>检验</td><td>t.test（自带函数）</td></tr><tr class="even"><td>成对数据的两样本均值检验</td><td></td><td><span class="math inline">\(t\)</span>检验</td><td>t.test（自带函数）</td></tr><tr class="odd"><td>比较两总体方差</td><td></td><td><span class="math inline">\(F\)</span>检验</td><td>var.test</td></tr><tr class="even"><td>比率</td><td>精确检验</td><td>二项分布检验</td><td>binom.test</td></tr><tr class="odd"><td>比率</td><td>近似检验（样本量较小）</td><td>正态检验</td><td>prop.test</td></tr></tbody></table><p><strong>场景数据</strong>：假设某零售公司延长营业时间前后27个典型周的周销售额数据（以万元为单位）为：</p><p>延长之前：67.90, 76.12, 68.64, 74.94, 63.32, 50.43, 44.92, 64.59, 61.68, 65.01, 55.90, 54.88, 46.78, 55.54, 67.90, 71.62, 63.00, 59.50, 63.20, 64.86, 59.32, 53.45, 62.51, 48.78, 53.55, 59.57, 58.62</p><p>延长之后：86.10, 71.13, 116.25, 102.60, 97.51, 65.39, 69.56, 70.80, 83.46, 87.27, 89.83, 80.51, 76.78, 71.11, 90.22, 87.55, 87.60, 90.08, 101.80, 84.96, 97.69, 66.39, 104.06, 72.98, 72.19, 91.01, 84.36</p><h4 id="均值差的检验">均值差的检验</h4><h5 id="两个总体的方差已知">两个总体的方差已知</h5><p>假设上面销售额样本服从正态分布，且满足延长之前<span class="math inline">\(Y \sim N(\mu_1, 8)\)</span>，延长之后<span class="math inline">\(X \sim N(\mu_2, 12)\)</span>。延长营业时间后，在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，周销售额是否更高？</p><p>解：待检验的原假设为：<span class="math inline">\(\mu_1 - \mu_2 \geq 0\)</span>，备择假设为：<span class="math inline">\(\mu_1 - \mu_2 &lt; 0\)</span>，这是一个单侧检验问题。由于两个总体的方差<span class="math inline">\(\sigma_1^2\)</span>、<span class="math inline">\(\sigma_2^2\)</span>已知，使用双样本的<span class="math inline">\(z\)</span>检验。</p><ul><li>自定义函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">86.10</span>, <span class="number">71.13</span>, <span class="number">116.25</span>, <span class="number">102.60</span>, <span class="number">97.51</span>, <span class="number">65.39</span>, <span class="number">69.56</span>, <span class="number">70.80</span>, </span><br><span class="line">       <span class="number">83.46</span>, <span class="number">87.27</span>, <span class="number">89.83</span>, <span class="number">80.51</span>, <span class="number">76.78</span>, <span class="number">71.11</span>, <span class="number">90.22</span>, <span class="number">87.55</span>, </span><br><span class="line">       <span class="number">87.60</span>, <span class="number">90.08</span>, <span class="number">101.80</span>, <span class="number">84.96</span>, <span class="number">97.69</span>, <span class="number">66.39</span>, <span class="number">104.06</span>, <span class="number">72.98</span>, </span><br><span class="line">       <span class="number">72.19</span>, <span class="number">91.01</span>, <span class="number">84.36</span>) <span class="comment"># 延长营业时间后的销售额样本</span></span><br><span class="line">y &lt;- c(<span class="number">67.90</span>, <span class="number">76.12</span>, <span class="number">68.64</span>, <span class="number">74.94</span>, <span class="number">63.32</span>, <span class="number">50.43</span>, <span class="number">44.92</span>, <span class="number">64.59</span>, </span><br><span class="line">       <span class="number">61.68</span>, <span class="number">65.01</span>, <span class="number">55.90</span>, <span class="number">54.88</span>, <span class="number">46.78</span>, <span class="number">55.54</span>, <span class="number">67.90</span>, <span class="number">71.62</span>, </span><br><span class="line">       <span class="number">63.00</span>, <span class="number">59.50</span>, <span class="number">63.20</span>, <span class="number">64.86</span>, <span class="number">59.32</span>, <span class="number">53.45</span>, <span class="number">62.51</span>, <span class="number">48.78</span>, </span><br><span class="line">       <span class="number">53.55</span>, <span class="number">59.57</span>, <span class="number">58.62</span>) <span class="comment"># 延长营业时间前的销售额样本</span></span><br><span class="line"></span><br><span class="line">custom.z.test &lt;- <span class="keyword">function</span>(x, y, sigma1, sigma2, alternative = <span class="string">"two.sided"</span>)&#123;</span><br><span class="line">  m &lt;- length(x) <span class="comment"># 样本x的容量</span></span><br><span class="line">  n &lt;- length(y) <span class="comment"># 样本y的容量</span></span><br><span class="line">  mean.x &lt;- mean(x) <span class="comment"># 样本x的均值 </span></span><br><span class="line">  mean.y &lt;- mean(y) <span class="comment"># 样本y的均值</span></span><br><span class="line">  z &lt;- (mean.x - mean.y) / sqrt(sigma1^<span class="number">2</span> / m + sigma2^<span class="number">2</span> / n) <span class="comment"># 统计量</span></span><br><span class="line">  ret &lt;- list() <span class="comment"># 创建一个空的list，用于存放输出结果</span></span><br><span class="line">  ret$z &lt;- z</span><br><span class="line">  <span class="keyword">if</span> (alternative == <span class="string">"two.sided"</span>)</span><br><span class="line">    ret$p &lt;- <span class="number">2</span> * pnorm(abs(z), lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"less"</span>)</span><br><span class="line">    ret$p &lt;- pnorm(z)</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (alternative == <span class="string">"greater"</span>)</span><br><span class="line">    ret$p &lt;- pnorm(z, lower.tail = <span class="literal">FALSE</span>)</span><br><span class="line">  ret</span><br><span class="line">&#125;</span><br><span class="line">custom.z.test(y, x, <span class="number">8</span>, <span class="number">12</span>, alternative = <span class="string">"less"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$z</span><br><span class="line">[<span class="number">1</span>] -<span class="number">8.842544</span></span><br><span class="line">$p</span><br><span class="line">[<span class="number">1</span>] <span class="number">4.678191e-19</span></span><br></pre></td></tr></table></figure><ul><li>BSDA包的z.test函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">"BSDA"</span>) <span class="comment"># 安装BSDA包，若已安装，则删除此行</span></span><br><span class="line"><span class="keyword">library</span>(BSDA)</span><br><span class="line">x &lt;- c(<span class="number">86.10</span>, <span class="number">71.13</span>, <span class="number">116.25</span>, <span class="number">102.60</span>, <span class="number">97.51</span>, <span class="number">65.39</span>, <span class="number">69.56</span>, <span class="number">70.80</span>, </span><br><span class="line">       <span class="number">83.46</span>, <span class="number">87.27</span>, <span class="number">89.83</span>, <span class="number">80.51</span>, <span class="number">76.78</span>, <span class="number">71.11</span>, <span class="number">90.22</span>, <span class="number">87.55</span>, </span><br><span class="line">       <span class="number">87.60</span>, <span class="number">90.08</span>, <span class="number">101.80</span>, <span class="number">84.96</span>, <span class="number">97.69</span>, <span class="number">66.39</span>, <span class="number">104.06</span>, <span class="number">72.98</span>, </span><br><span class="line">       <span class="number">72.19</span>, <span class="number">91.01</span>, <span class="number">84.36</span>) <span class="comment"># 延长营业时间后的销售额样本</span></span><br><span class="line">y &lt;- c(<span class="number">67.90</span>, <span class="number">76.12</span>, <span class="number">68.64</span>, <span class="number">74.94</span>, <span class="number">63.32</span>, <span class="number">50.43</span>, <span class="number">44.92</span>, <span class="number">64.59</span>, </span><br><span class="line">       <span class="number">61.68</span>, <span class="number">65.01</span>, <span class="number">55.90</span>, <span class="number">54.88</span>, <span class="number">46.78</span>, <span class="number">55.54</span>, <span class="number">67.90</span>, <span class="number">71.62</span>, </span><br><span class="line">       <span class="number">63.00</span>, <span class="number">59.50</span>, <span class="number">63.20</span>, <span class="number">64.86</span>, <span class="number">59.32</span>, <span class="number">53.45</span>, <span class="number">62.51</span>, <span class="number">48.78</span>, </span><br><span class="line">       <span class="number">53.55</span>, <span class="number">59.57</span>, <span class="number">58.62</span>) <span class="comment"># 延长营业时间前的销售额样本</span></span><br><span class="line">z.test(y, x, sigma.x = <span class="number">8</span>, sigma.y = <span class="number">12</span>, alternative = <span class="string">"less"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	Two-sample z-Test</span><br><span class="line">data:  y and x</span><br><span class="line">z = -<span class="number">8.8425</span>, p-value &lt; <span class="number">2.2e-16</span></span><br><span class="line">alternative hypothesis: true difference <span class="keyword">in</span> means is less than <span class="number">0</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line">        <span class="literal">NA</span> -<span class="number">19.97758</span></span><br><span class="line">sample estimates:</span><br><span class="line">mean of x mean of y </span><br><span class="line"> <span class="number">60.61222</span>  <span class="number">85.15519</span></span><br></pre></td></tr></table></figure><p>上面两个输出结果显示，z为检验统计量，p-value为检验的<span class="math inline">\(p\)</span>值，因为p-value &lt; 显著性水平<span class="math inline">\(\alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，应当拒绝原假设。</p><h5 id="两个总体的方差未知">两个总体的方差未知</h5><p>假设上面销售额样本服从正态分布，且满足延长之前<span class="math inline">\(Y \sim N(\mu_1, \sigma_1^2)\)</span>，延长之后<span class="math inline">\(X \sim N(\mu_2, \sigma_2^2)\)</span>。延长营业时间后，在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，周销售额是否更高？</p><p>解：待检验的原假设为：<span class="math inline">\(\mu_1 - \mu_2 \geq 0\)</span>，备择假设为：<span class="math inline">\(\mu_1 - \mu_2 &lt; 0\)</span>，这是一个单侧检验问题。由于两个总体的方差<span class="math inline">\(\sigma_1^2\)</span>、<span class="math inline">\(\sigma_2^2\)</span>未知，使用双样本的<span class="math inline">\(t\)</span>检验。</p><p>输入样本数据：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">86.10</span>, <span class="number">71.13</span>, <span class="number">116.25</span>, <span class="number">102.60</span>, <span class="number">97.51</span>, <span class="number">65.39</span>, <span class="number">69.56</span>, <span class="number">70.80</span>, </span><br><span class="line">       <span class="number">83.46</span>, <span class="number">87.27</span>, <span class="number">89.83</span>, <span class="number">80.51</span>, <span class="number">76.78</span>, <span class="number">71.11</span>, <span class="number">90.22</span>, <span class="number">87.55</span>, </span><br><span class="line">       <span class="number">87.60</span>, <span class="number">90.08</span>, <span class="number">101.80</span>, <span class="number">84.96</span>, <span class="number">97.69</span>, <span class="number">66.39</span>, <span class="number">104.06</span>, <span class="number">72.98</span>, </span><br><span class="line">       <span class="number">72.19</span>, <span class="number">91.01</span>, <span class="number">84.36</span>) <span class="comment"># 延长营业时间后的销售额样本</span></span><br><span class="line">y &lt;- c(<span class="number">67.90</span>, <span class="number">76.12</span>, <span class="number">68.64</span>, <span class="number">74.94</span>, <span class="number">63.32</span>, <span class="number">50.43</span>, <span class="number">44.92</span>, <span class="number">64.59</span>, </span><br><span class="line">       <span class="number">61.68</span>, <span class="number">65.01</span>, <span class="number">55.90</span>, <span class="number">54.88</span>, <span class="number">46.78</span>, <span class="number">55.54</span>, <span class="number">67.90</span>, <span class="number">71.62</span>, </span><br><span class="line">       <span class="number">63.00</span>, <span class="number">59.50</span>, <span class="number">63.20</span>, <span class="number">64.86</span>, <span class="number">59.32</span>, <span class="number">53.45</span>, <span class="number">62.51</span>, <span class="number">48.78</span>, </span><br><span class="line">       <span class="number">53.55</span>, <span class="number">59.57</span>, <span class="number">58.62</span>) <span class="comment"># 延长营业时间前的销售额样本</span></span><br></pre></td></tr></table></figure><p>若两个总体方差相等，<span class="math inline">\(\sigma_1^2 = \sigma_2^2\)</span></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.test(y, x, alternative = <span class="string">"less"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	Welch Two Sample t-test</span><br><span class="line">data:  y and x</span><br><span class="line">t = -<span class="number">8.3792</span>, df = <span class="number">43.567</span>, p-value = <span class="number">6.257e-11</span></span><br><span class="line">alternative hypothesis: true difference <span class="keyword">in</span> means is less than <span class="number">0</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line">      -<span class="literal">Inf</span> -<span class="number">19.62045</span></span><br><span class="line">sample estimates:</span><br><span class="line">mean of x mean of y </span><br><span class="line"> <span class="number">60.61222</span>  <span class="number">85.15519</span></span><br></pre></td></tr></table></figure><p>若两个总体方差不等<span class="math inline">\(\sigma_1^2 \neq \sigma_2^2\)</span>，则设置t.test函数中的var.equal参数为FALSE</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.test(y, x, var.equal = <span class="literal">FALSE</span>, alternative = <span class="string">"less"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	Welch Two Sample t-test</span><br><span class="line">data:  y and x</span><br><span class="line">t = -<span class="number">8.3792</span>, df = <span class="number">43.567</span>, p-value = <span class="number">6.257e-11</span></span><br><span class="line">alternative hypothesis: true difference <span class="keyword">in</span> means is less than <span class="number">0</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line">      -<span class="literal">Inf</span> -<span class="number">19.62045</span></span><br><span class="line">sample estimates:</span><br><span class="line">mean of x mean of y </span><br><span class="line"> <span class="number">60.61222</span>  <span class="number">85.15519</span></span><br></pre></td></tr></table></figure><p>上面两个输出结果显示，t为检验统计量，df为自由度，p-value为检验的<span class="math inline">\(p\)</span>值，置信水平为0.95时的置信区间为[-Inf, -19.62045]。因为<span class="math inline">\(p = 6.257 \times 10^{-11} &lt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，应当拒绝原假设。这说明延长营业时间后销售额更高。</p><h4 id="成对数据的比较检验">成对数据的比较检验</h4><p><strong>例</strong>：银行经理发觉目前过于强调顾客的存款数，他认为必须同时强调存款的期限。为此设计了一种将存款数与存款期相乘的指数，然后介绍了一种有刺激性的有奖计划，尽量减少顾客取款。现在他随机选择了15个储户，比较了在引用新计划前后的指数，指数数据如下：</p><table><thead><tr class="header"><th>储户编号</th><th>后</th><th>前</th><th>差<span class="math inline">\(Y_i\)</span>后 - 前（元）</th></tr></thead><tbody><tr class="odd"><td>1</td><td>10540</td><td>10020</td><td>520</td></tr><tr class="even"><td>2</td><td>780</td><td>720</td><td>60</td></tr><tr class="odd"><td>3</td><td>9453</td><td>9105</td><td>348</td></tr><tr class="even"><td>4</td><td>1573</td><td>1062</td><td>511</td></tr><tr class="odd"><td>5</td><td>3962</td><td>3905</td><td>57</td></tr><tr class="even"><td>6</td><td>4673</td><td>4401</td><td>272</td></tr><tr class="odd"><td>7</td><td>8205</td><td>8100</td><td>105</td></tr><tr class="even"><td>8</td><td>12458</td><td>12011</td><td>447</td></tr><tr class="odd"><td>9</td><td>959</td><td>847</td><td>112</td></tr><tr class="even"><td>10</td><td>7444</td><td>6853</td><td>591</td></tr><tr class="odd"><td>11</td><td>4982</td><td>4602</td><td>380</td></tr><tr class="even"><td>12</td><td>8831</td><td>8452</td><td>379</td></tr><tr class="odd"><td>13</td><td>648</td><td>182</td><td>466</td></tr><tr class="even"><td>14</td><td>6969</td><td>6740</td><td>229</td></tr><tr class="odd"><td>15</td><td>2408</td><td>2378</td><td>30</td></tr></tbody></table><p>试在显著性水平<span class="math inline">\(\alpha = 0.01\)</span>下，检验该经理的计划是否有效。</p><p>解：以<span class="math inline">\(Y\)</span>记为"新旧方法之下一储户存款指数之差"。这里每储户在新旧两种方法下的指数自然地构成了一个对，故表中每个<span class="math inline">\(Y_i\)</span>正反映了这两种方法的差别。若假定<span class="math inline">\(Y \sim N(\mu, \sigma^2)\)</span>，且把"新方法无效"作为原假设，则问题归结为假设检验问题，即原假设：<span class="math inline">\(\mu \leq 0\)</span>，备择假设：<span class="math inline">\(\mu &gt; 0\)</span>。这是一个单样本单侧<span class="math inline">\(t\)</span>检验问题，所以使用t.test函数来进行检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">x &lt;- c(<span class="number">520</span>, <span class="number">60</span>, <span class="number">348</span>, <span class="number">511</span>, <span class="number">57</span>, <span class="number">272</span>, <span class="number">105</span>, <span class="number">447</span>, </span><br><span class="line">       <span class="number">112</span>, <span class="number">591</span>, <span class="number">380</span>, <span class="number">379</span>, <span class="number">466</span>, <span class="number">229</span>, <span class="number">30</span>)</span><br><span class="line"><span class="comment"># conf.level为置信水平0.99 = 1 - 0.01</span></span><br><span class="line"><span class="comment"># alternative = "greater"表示为右侧检验</span></span><br><span class="line">t.test(x = x, conf.level = <span class="number">0.99</span>, alternative = <span class="string">"greater"</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	One Sample t-test</span><br><span class="line">data:  x</span><br><span class="line">t = <span class="number">6.0944</span>, df = <span class="number">14</span>, p-value = <span class="number">1.385e-05</span></span><br><span class="line">alternative hypothesis: true mean is greater than <span class="number">0</span></span><br><span class="line"><span class="number">99</span> percent confidence interval:</span><br><span class="line"> <span class="number">171.0729</span>      <span class="literal">Inf</span></span><br><span class="line">sample estimates:</span><br><span class="line">mean of x </span><br><span class="line"> <span class="number">300.4667</span></span><br></pre></td></tr></table></figure><p>输出结果显示，t为检验统计量值，df为自由度，p-value为检验<span class="math inline">\(p\)</span>值，置信水平为0.99时的置信区间为[171.0729, Inf]。因为<span class="math inline">\(p = 1.385\times 10^{-5} &lt; \alpha = 0.01\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.01\)</span>下，应当拒绝原假设。这表明观察值显著地支持新方法有助于提高存款指数。</p><h4 id="方差的检验-1">方差的检验</h4><h5 id="方差比的检验">方差比的检验</h5><p>假设上面销售额样本服从正态分布，且满足延长之前<span class="math inline">\(Y \sim N(\mu_1, \sigma_1^2)\)</span>，延长之后<span class="math inline">\(X \sim N(\mu_2, \sigma_2^2)\)</span>。延长营业时间后，在显著性水平<span class="math inline">\(\alpha = 0.05\)</span>下，周销售额的波动是否与之前一致？</p><p>解：待检验的原假设为：<span class="math inline">\(\sigma_1^2 = \sigma_2^2\)</span>，备择假设为：<span class="math inline">\(\sigma_1^2 \neq \sigma_2^2\)</span>，这是一个双侧检验问题。可以使用双样本的<span class="math inline">\(F\)</span>检验检测。</p><ul><li>var.test函数</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">86.10</span>, <span class="number">71.13</span>, <span class="number">116.25</span>, <span class="number">102.60</span>, <span class="number">97.51</span>, <span class="number">65.39</span>, <span class="number">69.56</span>, <span class="number">70.80</span>, </span><br><span class="line">       <span class="number">83.46</span>, <span class="number">87.27</span>, <span class="number">89.83</span>, <span class="number">80.51</span>, <span class="number">76.78</span>, <span class="number">71.11</span>, <span class="number">90.22</span>, <span class="number">87.55</span>, </span><br><span class="line">       <span class="number">87.60</span>, <span class="number">90.08</span>, <span class="number">101.80</span>, <span class="number">84.96</span>, <span class="number">97.69</span>, <span class="number">66.39</span>, <span class="number">104.06</span>, <span class="number">72.98</span>, </span><br><span class="line">       <span class="number">72.19</span>, <span class="number">91.01</span>, <span class="number">84.36</span>) <span class="comment"># 延长营业时间后的销售额样本</span></span><br><span class="line">y &lt;- c(<span class="number">67.90</span>, <span class="number">76.12</span>, <span class="number">68.64</span>, <span class="number">74.94</span>, <span class="number">63.32</span>, <span class="number">50.43</span>, <span class="number">44.92</span>, <span class="number">64.59</span>, </span><br><span class="line">       <span class="number">61.68</span>, <span class="number">65.01</span>, <span class="number">55.90</span>, <span class="number">54.88</span>, <span class="number">46.78</span>, <span class="number">55.54</span>, <span class="number">67.90</span>, <span class="number">71.62</span>, </span><br><span class="line">       <span class="number">63.00</span>, <span class="number">59.50</span>, <span class="number">63.20</span>, <span class="number">64.86</span>, <span class="number">59.32</span>, <span class="number">53.45</span>, <span class="number">62.51</span>, <span class="number">48.78</span>, </span><br><span class="line">       <span class="number">53.55</span>, <span class="number">59.57</span>, <span class="number">58.62</span>) <span class="comment"># 延长营业时间前的销售额样本</span></span><br><span class="line">var.test(y, x)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	<span class="literal">F</span> test to compare two variances</span><br><span class="line">data:  y and x</span><br><span class="line"><span class="literal">F</span> = <span class="number">0.38893</span>, num df = <span class="number">26</span>, denom df = <span class="number">26</span>, p-value = <span class="number">0.01914</span></span><br><span class="line">alternative hypothesis: true ratio of variances is not equal to <span class="number">1</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line"> <span class="number">0.1772458</span> <span class="number">0.8534348</span></span><br><span class="line">sample estimates:</span><br><span class="line">ratio of variances </span><br><span class="line">         <span class="number">0.3889315</span></span><br></pre></td></tr></table></figure><p>输出结果显示，F为检验统计量，num df为分子自由度，denom df为分母自由度，p-value为检验的<span class="math inline">\(p\)</span>值，置信水平为0.95时的置信区间为[0.1772458, 0.8534348]。因为p-value = 0.01914 &lt; 显著性水平<span class="math inline">\(\alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，应当拒绝原假设。这说明延长营业时间前后的销售额的方差不相同。</p><h2 id="其它分布参数的假设检验">其它分布参数的假设检验</h2><h3 id="比例的检验">比例的检验</h3><p><strong>例</strong>：某厂生产某种产品，每批次产量很大，出厂标准是次品率不超过2%。现从一批产品中随机抽取400件，发现12件次品。在显著性水<span class="math inline">\(\alpha = 0.05\)</span>下，能否让这批产品出厂？</p><p>解：这是关于不合格品率<span class="math inline">\(p\)</span>的假设检验，假设原假设：<span class="math inline">\(p = 0.02\)</span>，备择假设：<span class="math inline">\(p \neq 0.02\)</span>。假设以<span class="math inline">\(x\)</span>表示样品中不合格品的个数，当从产品中随机抽取1件样品，则<span class="math inline">\(x\)</span>服从二点分布（合格或不合格），即<span class="math inline">\(x \sim b(1, p)\)</span>。现从产品中抽取400件样品<span class="math inline">\((x_1,\cdots,x_n;n=400)\)</span>，由分布的可列可加性得到统计量$ T = _{i = 1}^{400}x_i<span class="math inline">\(服从二项分布，即\)</span>T b(400, p)$。所以可以使用R中的binom.test函数完成检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x表示n次试验中，事件发生的次数</span></span><br><span class="line"><span class="comment"># n表示试验次数</span></span><br><span class="line"><span class="comment"># p表示原假设中，事件发生的概率</span></span><br><span class="line"><span class="comment"># conf.level表示置信水平，即0.95 = 1 - 显著性水平0.05</span></span><br><span class="line">binom.test(x = <span class="number">12</span>, n= <span class="number">400</span>, p = <span class="number">0.02</span>, conf.level = <span class="number">0.95</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	Exact binomial test</span><br><span class="line">data:  <span class="number">12</span> and <span class="number">400</span></span><br><span class="line">number of successes = <span class="number">12</span>, number of trials = <span class="number">400</span>, p-value =</span><br><span class="line"><span class="number">0.1507</span></span><br><span class="line">alternative hypothesis: true probability of success is not equal to <span class="number">0.02</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line"> <span class="number">0.01559555</span> <span class="number">0.05181722</span></span><br><span class="line">sample estimates:</span><br><span class="line">probability of success </span><br><span class="line">                  <span class="number">0.03</span></span><br></pre></td></tr></table></figure><p>输出结果显示，检验的<span class="math inline">\(p\)</span>值为0.1507，置信水平0.95下的置信区间为[0.01559555, 0.05181722]，不合格品率的点估计为0.03。因为<span class="math inline">\(p = 0.1507 &gt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，不能拒绝原假设。这说明可以认为这批产品的次品率仍为2%，可以出厂。</p><h3 id="大样本检验">大样本检验</h3><p>上面使用二项分布检验比例<span class="math inline">\(p\)</span>值，有一个问题：若样本量<span class="math inline">\(n\)</span>太小，则检验难于作出可靠结论。因此如果样本量<span class="math inline">\(n\)</span>较大，可以使用近似的检验方法：<strong>大样本检验</strong>。大样本检验的一般思路是：设<span class="math inline">\(x_1,\cdots,x_n\)</span>是来自某总体的样本，又设该总体均值为<span class="math inline">\(\theta\)</span>，方差为<span class="math inline">\(\theta\)</span>的的函数，记为<span class="math inline">\(\sigma^2(\theta)\)</span>。在样本量<span class="math inline">\(n\)</span>充分大时，根据中心极限定理可知，样本均值<span class="math inline">\(\overline{x}\)</span>近似服从<span class="math inline">\(N(\theta,\sigma^2(\theta)/n)\)</span>，从而可以把问题转化为正态分布去处理。</p><p>对于上面不合格品率的场景，样本比例的抽样分布近似服从正态分布，可以使用prop.test函数进行检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># x表示n次试验中，事件发生的次数</span></span><br><span class="line"><span class="comment"># n表示试验次数</span></span><br><span class="line"><span class="comment"># p表示原假设中，事件发生的概率</span></span><br><span class="line"><span class="comment"># conf.level表示置信水平，即0.95 = 1 - 显著性水平0.05</span></span><br><span class="line">prop.test(x = <span class="number">12</span>, n = <span class="number">400</span>, p = <span class="number">0.02</span>, conf.level = <span class="number">0.95</span>)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	<span class="number">1</span>-sample proportions test with continuity correction</span><br><span class="line">data:  <span class="number">12</span> out of <span class="number">400</span>, null probability <span class="number">0.02</span></span><br><span class="line">X-squared = <span class="number">1.5625</span>, df = <span class="number">1</span>, p-value = <span class="number">0.2113</span></span><br><span class="line">alternative hypothesis: true p is not equal to <span class="number">0.02</span></span><br><span class="line"><span class="number">95</span> percent confidence interval:</span><br><span class="line"> <span class="number">0.01632970</span> <span class="number">0.05325459</span></span><br><span class="line">sample estimates:</span><br><span class="line">   p </span><br><span class="line"><span class="number">0.03</span></span><br></pre></td></tr></table></figure><p>输出结果显示，检验的<span class="math inline">\(p\)</span>值为0.2113，置信水平0.95下的置信区间为[0.01632970, 0.05325459]，不合格品率的点估计为0.03。因为<span class="math inline">\(p = 0.2113 &gt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，不能拒绝原假设。这说明可以认为这批产品的次品率仍为2%，可以出厂。</p><h2 id="分布拟合检验">分布拟合检验</h2><h3 id="neyman-pearson拟合度卡方检验">Neyman-Pearson拟合度卡方检验</h3><p><strong>场景数据</strong>：假设2012年各月北京的新建住宅价格指数样本数据如下：</p><table><thead><tr class="header"><th>1月</th><th>2月</th><th>3月</th><th>4月</th><th>5月</th><th>6月</th><th>7月</th><th>8月</th><th>9月</th><th>10月</th><th>11月</th><th>12月</th></tr></thead><tbody><tr class="odd"><td>102.5</td><td>102.4</td><td>102</td><td>101.8</td><td>101.8</td><td>102.1</td><td>102.3</td><td>102.5</td><td>102.6</td><td>102.8</td><td>103.4</td><td>104.2</td></tr></tbody></table><p>使用Neyman-Pearson卡方检验来判断北京市新建住宅价格指数是否服从正态分布。</p><ol type="1"><li>输入数据，绘制直方图，对数据的分布形态进行初步了解。</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">102.5</span>, <span class="number">102.4</span>, <span class="number">102</span>, <span class="number">101.8</span>, <span class="number">101.8</span>, <span class="number">102.1</span>, </span><br><span class="line">       <span class="number">102.3</span>, <span class="number">102.5</span>, <span class="number">102.6</span>, <span class="number">102.8</span>, <span class="number">103.4</span>, <span class="number">104.2</span>)</span><br><span class="line">hist(x)</span><br></pre></td></tr></table></figure><p>输出结果：</p> <img src="/R语言/假设检验及r实现/chi_test_norm.png" title="北京市新建住宅价格指数直方图"><ol start="2" type="1"><li>对数据进行分组，计算频数分布。</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">k &lt;- <span class="number">5</span> <span class="comment"># 组个数</span></span><br><span class="line">min &lt;- min(x)</span><br><span class="line">max &lt;- max(x)</span><br><span class="line">d &lt;- (max - min) / k <span class="comment"># 组距</span></span><br><span class="line"><span class="comment"># 分组端点</span></span><br><span class="line">endPoints &lt;- c(min - <span class="number">0.1</span>, min + d, min + <span class="number">2</span> * d, min + <span class="number">3</span> * d, min + <span class="number">4</span> * d, max + <span class="number">0.1</span>)</span><br><span class="line"><span class="comment"># 频数分布</span></span><br><span class="line">(freq &lt;- table(cut(x, breaks = endPoints)))</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">101.7</span>,<span class="number">102.3</span>] (<span class="number">102.3</span>,<span class="number">102.8</span>] (<span class="number">102.8</span>,<span class="number">103.2</span>] (<span class="number">103.2</span>,<span class="number">103.7</span>] </span><br><span class="line">            <span class="number">4</span>             <span class="number">5</span>             <span class="number">1</span>             <span class="number">1</span> </span><br><span class="line">(<span class="number">103.7</span>,<span class="number">104.3</span>] </span><br><span class="line">            <span class="number">1</span></span><br></pre></td></tr></table></figure><ol start="3" type="1"><li>计算原假设条件下数据落入各区间的理论值，由于假设的时正态分布，所以先计算样本均值和标准差，再用正态分布函数pnorm计算落入各小区间内的理论概率。</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">points &lt;- c(min, min + d, min + <span class="number">2</span> * d, min + <span class="number">3</span> * d, min +  <span class="number">4</span> * d, max)</span><br><span class="line">p &lt;- pnorm(points, mean(x), sd(x))</span><br><span class="line">(p &lt;- c(p[<span class="number">1</span>], p[<span class="number">2</span>] - p[<span class="number">1</span>], p[<span class="number">3</span>] - p[<span class="number">2</span>], p[<span class="number">4</span>] - p[<span class="number">3</span>], <span class="number">1</span> - p[<span class="number">4</span>]))</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] <span class="number">0.1436956</span> <span class="number">0.2129215</span> <span class="number">0.2722409</span> <span class="number">0.2185020</span> <span class="number">0.1526400</span></span><br></pre></td></tr></table></figure><ol start="4" type="1"><li>使用函数chisq.test完成Neyman-Pearson拟合度卡方检验</li></ol><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chisq.test(freq, p = p)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chi-squared approximation may be incorrect</span><br><span class="line">	Chi-squared test <span class="keyword">for</span> given probabilities</span><br><span class="line">data:  freq</span><br><span class="line">X-squared = <span class="number">8.2968</span>, df = <span class="number">4</span>, p-value = <span class="number">0.08129</span></span><br></pre></td></tr></table></figure><p>输出结果显示，X-squared为检验统计量的值，df为自由度，p-value为检验的<span class="math inline">\(p\)</span>值。因为<span class="math inline">\(p = 0.08129 &gt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，不能拒绝原假设。这说明可以认为北京市新建住宅价格指数服从正态分布。</p><h3 id="kolmogrov-smirnov检验">Kolmogrov-Smirnov检验</h3><h4 id="单样本检验">单样本检验</h4><p><strong>场景数据</strong>：某气象站收集了44个独立的年降雨量数据，资料如下：</p><p>520, 556, 561, 616, 635, 669, 686, 692, 704, 704, 711,</p><p>713, 714, 719, 727, 735, 740, 744, 745, 750, 776, 777,</p><p>786, 786, 791, 794, 821, 822, 826, 834, 837, 851, 862,</p><p>873, 879, 889, 900, 904, 922, 926, 952, 963, 1056, 1074</p><p>根据这批数据验证其服从正态分布。</p><p>解：这是一个分布拟合的假设检验问题。原假设：降雨量总体服从正态分布，备择假设：降雨量总体不服从正态分布。在原假设成立时，可以求出该正态分布的期望和方差的点估计，然后根据点估计使用Kolmogrov-Smirnov检验进行检测检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">520</span>, <span class="number">556</span>, <span class="number">561</span>, <span class="number">616</span>, <span class="number">635</span>, <span class="number">669</span>, <span class="number">686</span>, <span class="number">692</span>, </span><br><span class="line">       <span class="number">704</span>, <span class="number">704</span>, <span class="number">711</span>, <span class="number">713</span>, <span class="number">714</span>, <span class="number">719</span>, <span class="number">727</span>, <span class="number">735</span>, </span><br><span class="line">       <span class="number">740</span>, <span class="number">744</span>, <span class="number">745</span>, <span class="number">750</span>, <span class="number">776</span>, <span class="number">777</span>, <span class="number">786</span>, <span class="number">786</span>, </span><br><span class="line">       <span class="number">791</span>, <span class="number">794</span>, <span class="number">821</span>, <span class="number">822</span>, <span class="number">826</span>, <span class="number">834</span>, <span class="number">837</span>, <span class="number">851</span>, </span><br><span class="line">       <span class="number">862</span>, <span class="number">873</span>, <span class="number">879</span>, <span class="number">889</span>, <span class="number">900</span>, <span class="number">904</span>, <span class="number">922</span>, <span class="number">926</span>, </span><br><span class="line">       <span class="number">952</span>, <span class="number">963</span>, <span class="number">1056</span>, <span class="number">1074</span>) <span class="comment"># 输入样本</span></span><br><span class="line"><span class="comment"># 似然函数</span></span><br><span class="line">f &lt;- <span class="keyword">function</span>(para)&#123;</span><br><span class="line">  mean &lt;- mean(x)</span><br><span class="line">  le.fun &lt;- dnorm(x, para[<span class="number">1</span>], para[<span class="number">2</span>])</span><br><span class="line">  <span class="comment"># 因为nlminb求的是最小值，而这里要的是最大值，所以要添加一个负号</span></span><br><span class="line">  <span class="keyword">return</span>(-sum(log(le.fun)))</span><br><span class="line">&#125;</span><br><span class="line">lower &lt;- c(<span class="number">0.0001</span>, <span class="number">0.0001</span>)  <span class="comment"># 参数取值范围下界</span></span><br><span class="line">upper &lt;- c(<span class="literal">Inf</span>, <span class="literal">Inf</span>) <span class="comment"># 参数取值范围上界</span></span><br><span class="line">ret &lt;- nlminb(c(mean(x), var(x)), f, lower = lower, upper = upper) <span class="comment"># 求极大似然估计</span></span><br><span class="line"><span class="comment"># 采用秩统计量，在排序过程中若样本x中有重复值，就会显示</span></span><br><span class="line"><span class="comment"># 警告：ties should not be present for the Kolmogorov-Smirnov test</span></span><br><span class="line"><span class="comment"># 可以使用jitter(x)为样本增加一些噪声，但不影响分布，也不会影响最终的检测结果。</span></span><br><span class="line"><span class="comment"># y是要检验的分布的分布函数的名称，这里要检验拟合的是正态分布，所以使用"pnorm"</span></span><br><span class="line"><span class="comment"># ret$par[1]为期望的极大似然估计</span></span><br><span class="line"><span class="comment"># ret$par[2]方差的极大似然估计</span></span><br><span class="line">ks.test(jitter(x), y = <span class="string">"pnorm"</span>, ret$par[<span class="number">1</span>], ret$par[<span class="number">2</span>])</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	One-sample Kolmogorov-Smirnov test</span><br><span class="line">data:  jitter(x)</span><br><span class="line">D = <span class="number">0.070192</span>, p-value = <span class="number">0.9712</span></span><br><span class="line">alternative hypothesis: two-sided</span><br></pre></td></tr></table></figure><p>输出结果显示，D为检验统计量，p-value为检验的<span class="math inline">\(p\)</span>值。因为<span class="math inline">\(p = 0.9712 &gt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，不能拒绝原假设。</p><h4 id="双样本检验">双样本检验</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用标准正态分布分别随机生成样本量为30的x样本和40的y样本</span></span><br><span class="line">x &lt;- rnorm(<span class="number">30</span>)</span><br><span class="line">y &lt;- rnorm(<span class="number">40</span>)</span><br><span class="line"><span class="comment"># 使用均匀分布随机生成35个0到1之间随机数的样本z</span></span><br><span class="line">z &lt;- runif(<span class="number">35</span>)</span><br><span class="line"><span class="comment"># 检验x样本和y样本是否为同一分布</span></span><br><span class="line">ks.test(x, y)</span><br><span class="line"><span class="comment"># 检验x样本和z样本是否为同一分布</span></span><br><span class="line">ks.test(x, z)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	Two-sample Kolmogorov-Smirnov test</span><br><span class="line">data:  x and y</span><br><span class="line">D = <span class="number">0.2</span>, p-value = <span class="number">0.4509</span></span><br><span class="line">alternative hypothesis: two-sided</span><br><span class="line"></span><br><span class="line">	Two-sample Kolmogorov-Smirnov test</span><br><span class="line">data:  x and z</span><br><span class="line">D = <span class="number">0.5381</span>, p-value = <span class="number">7.968e-05</span></span><br><span class="line">alternative hypothesis: two-sided</span><br></pre></td></tr></table></figure><p>输出结果显示，在x样本和y样本的检验中<span class="math inline">\(p = 0.4509 &gt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，可以认为x样本和y样本为同一分布。在x样本和z样本的的检验中<span class="math inline">\(p = 7.968 \times 10^{-5} &lt; \alpha = 0.05\)</span>，所以所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，可以认为x样本和z样本不是同一分布。</p><h3 id="w检验"><span class="math inline">\(W\)</span>检验</h3><p>使用上面Kolmogrov-Smirnov检验中单样本检验的降雨量的数据，使用Shapiro-Wilk检验（简称<span class="math inline">\(W\)</span>检验）进行正态分布拟合检验。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- c(<span class="number">520</span>, <span class="number">556</span>, <span class="number">561</span>, <span class="number">616</span>, <span class="number">635</span>, <span class="number">669</span>, <span class="number">686</span>, <span class="number">692</span>, <span class="number">704</span>, <span class="number">704</span>, <span class="number">711</span>,</span><br><span class="line">       <span class="number">713</span>, <span class="number">714</span>, <span class="number">719</span>, <span class="number">727</span>, <span class="number">735</span>, <span class="number">740</span>, <span class="number">744</span>, <span class="number">745</span>, <span class="number">750</span>, <span class="number">776</span>, <span class="number">777</span>,</span><br><span class="line">       <span class="number">786</span>, <span class="number">786</span>, <span class="number">791</span>, <span class="number">794</span>, <span class="number">821</span>, <span class="number">822</span>, <span class="number">826</span>, <span class="number">834</span>, <span class="number">837</span>, <span class="number">851</span>, <span class="number">862</span>,</span><br><span class="line">       <span class="number">873</span>, <span class="number">879</span>, <span class="number">889</span>, <span class="number">900</span>, <span class="number">904</span>, <span class="number">922</span>, <span class="number">926</span>, <span class="number">952</span>, <span class="number">963</span>, <span class="number">1056</span>, <span class="number">1074</span>)</span><br><span class="line">shapiro.test(x)</span><br></pre></td></tr></table></figure><p>输出结果：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	Shapiro-Wilk normality test</span><br><span class="line">data:  x</span><br><span class="line">W = <span class="number">0.98596</span>, p-value = <span class="number">0.8622</span></span><br></pre></td></tr></table></figure><p>输出结果显示，因为<span class="math inline">\(p = 0.8622 &gt; \alpha = 0.05\)</span>，所以在显著性水平<span class="math inline">\(\alpha=0.05\)</span>下，不能拒绝原假设，可以认为降雨量总体服从正态分布。</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/R语言/" rel="tag"><i class="fa fa-tag"></i> R语言</a><a href="/tags/z检验/" rel="tag"><i class="fa fa-tag"></i> z检验</a><a href="/tags/t检验/" rel="tag"><i class="fa fa-tag"></i> t检验</a><a href="/tags/F检验/" rel="tag"><i class="fa fa-tag"></i> F检验</a><a href="/tags/卡方检验/" rel="tag"><i class="fa fa-tag"></i> 卡方检验</a><a href="/tags/KS检验/" rel="tag"><i class="fa fa-tag"></i> KS检验</a><a href="/tags/W检验/" rel="tag"><i class="fa fa-tag"></i> W检验</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/R语言/参数估计及r实现/" rel="next" title="参数估计及R实现"><i class="fa fa-chevron-left"></i> 参数估计及R实现</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/概率论与数理统计/常用概率分布/" rel="prev" title="常用概率分布">常用概率分布<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap"> 站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">lwl</p><div class="site-description motion-element" itemprop="description"></div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">18</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">23</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#假设检验及r实现"><span class="nav-number">1.</span> <span class="nav-text">假设检验及R实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#正态总体参数假设检验"><span class="nav-number">1.1.</span> <span class="nav-text">正态总体参数假设检验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单个正态总体的检验"><span class="nav-number">1.1.1.</span> <span class="nav-text">单个正态总体的检验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#均值的检验"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">均值的检验</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#方差sigma2已知"><span class="nav-number">1.1.1.1.1.</span> <span class="nav-text">方差\(\sigma^2\)已知</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#方差sigma2未知"><span class="nav-number">1.1.1.1.2.</span> <span class="nav-text">方差\(\sigma^2\)未知</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方差的检验"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">方差的检验</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#两个正态总体的检验"><span class="nav-number">1.1.2.</span> <span class="nav-text">两个正态总体的检验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#均值差的检验"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">均值差的检验</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#两个总体的方差已知"><span class="nav-number">1.1.2.1.1.</span> <span class="nav-text">两个总体的方差已知</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#两个总体的方差未知"><span class="nav-number">1.1.2.1.2.</span> <span class="nav-text">两个总体的方差未知</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#成对数据的比较检验"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">成对数据的比较检验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方差的检验-1"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">方差的检验</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#方差比的检验"><span class="nav-number">1.1.2.3.1.</span> <span class="nav-text">方差比的检验</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其它分布参数的假设检验"><span class="nav-number">1.2.</span> <span class="nav-text">其它分布参数的假设检验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#比例的检验"><span class="nav-number">1.2.1.</span> <span class="nav-text">比例的检验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#大样本检验"><span class="nav-number">1.2.2.</span> <span class="nav-text">大样本检验</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分布拟合检验"><span class="nav-number">1.3.</span> <span class="nav-text">分布拟合检验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#neyman-pearson拟合度卡方检验"><span class="nav-number">1.3.1.</span> <span class="nav-text">Neyman-Pearson拟合度卡方检验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kolmogrov-smirnov检验"><span class="nav-number">1.3.2.</span> <span class="nav-text">Kolmogrov-Smirnov检验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单样本检验"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">单样本检验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#双样本检验"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">双样本检验</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#w检验"><span class="nav-number">1.3.3.</span> <span class="nav-text">\(W\)检验</span></a></li></ol></li></ol></li></ol></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span><span class="with-love" id="animate"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">lwl</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="站点总字数">164k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">2:29</span></div><div class="powered-by"><i class="fa fa-user-md"></i> <span id="busuanzi_container_site_uv">本站访客数:<span id="busuanzi_value_site_uv">&nbsp;</span></span></div><div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div> <span class="post-meta-divider">|</span><div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.1.0"></script><script src="/js/motion.js?v=7.1.0"></script><script src="/js/affix.js?v=7.1.0"></script><script src="/js/schemes/pisces.js?v=7.1.0"></script><script src="/js/scrollspy.js?v=7.1.0"></script><script src="/js/post-details.js?v=7.1.0"></script><script src="/js/next-boot.js?v=7.1.0"></script><script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script><script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });
  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling }
        if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next) }
      }
    });
  });
</script><script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
    }
  });
</script><script src="//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script><script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script></body></html>